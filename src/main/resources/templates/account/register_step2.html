<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>회원가입 - Step 2</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; margin-top: 50px; }
        .container { width: 500px; text-align: center; }
        .btn { margin-top: 20px; padding: 10px 20px; background: black; color: white; border: none; cursor: pointer; width: 100%; }
        .ott-options img { width: 50px; margin: 5px; cursor: pointer; }
        .genre-options button {
            margin: 5px; padding: 5px 10px; border-radius: 15px; border: 1px solid #999;
            background-color: #eee; cursor: pointer;
        }
        .genre-options button.selected {
            background-color: purple; color: white;
        }

        .ott-options img.selected {
            border: 3px solid purple;
            border-radius: 8px;
            opacity: 0.8;
            /* 원하는 스타일로 바꿔도 돼 */
        }

    </style>
    <script>
        function toggleSelect(elem) {
            elem.classList.toggle('selected');
        }
    </script>
</head>
<body>
<div class="container">
    <h1>Gachi Watch<br>회원가입</h1>
    <form id="signupForm" th:action="@{/account/register_result}" method="post" onsubmit="return handleSubmit();">

    <div class="form-group">
            <label for="nickname">닉네임</label>
            <input type="nickname" id="nickname" name="nickname" required>
            <button type="button">중복 확인</button>
        </div>


        <p><strong>구독중인 OTT 서비스를 선택해주세요</strong></p>
        <div class="ott-options">
            <img src="/static/image/netflix.png" alt="Netflix" data-value="넷플릭스">
            <img src="/static/image/watcha.png" alt="Watcha" data-value="왓챠">
            <img src="/static/image/disney.png" alt="Disney" data-value="디즈니+">
            <img src="/static/image/appletv.png" alt="Apple" data-value="애플티비+">
            <img src="/static/image/wavve.png" alt="wavve" data-value="웨이브" style="height: 30px;">
            <img src="/static/image/prime.png" alt="Amazon" data-value="아마존 프라임">
        </div>

        <p><strong>원하는 장르에 맞춰 추천해드릴게요</strong></p>
        <div class="genre-options">
            <button type="button" onclick="toggleSelect(this)">SF</button>
            <button type="button" onclick="toggleSelect(this)">TV 영화</button>
            <button type="button" onclick="toggleSelect(this)">가족</button>
            <button type="button" onclick="toggleSelect(this)">공포</button>
            <button type="button" onclick="toggleSelect(this)">다큐</button>
            <button type="button" onclick="toggleSelect(this)">드라마</button>
            <button type="button" onclick="toggleSelect(this)">로맨스</button>
            <button type="button" onclick="toggleSelect(this)">모험</button>
            <button type="button" onclick="toggleSelect(this)">미스터리</button>
            <button type="button" onclick="toggleSelect(this)">범죄</button>
            <button type="button" onclick="toggleSelect(this)">서부</button>
            <button type="button" onclick="toggleSelect(this)">스릴러</button>
            <button type="button" onclick="toggleSelect(this)">애니메이션</button>
            <button type="button" onclick="toggleSelect(this)">액션</button>
            <button type="button" onclick="toggleSelect(this)">역사</button>
            <button type="button" onclick="toggleSelect(this)">음악</button>
            <button type="button" onclick="toggleSelect(this)">전쟁</button>
            <button type="button" onclick="toggleSelect(this)">코미디</button>
            <button type="button" onclick="toggleSelect(this)">판타지</button>
        </div>

        <!-- 서버로 보낼 실제 hidden 값 -->
        <input type="hidden" name="subscribedOTTs" id="subscribedOTTs" />
        <input type="hidden" name="preferredGenres" id="preferredGenres" />

        <button class="btn">회원가입</button>
    </form>
</div>

<script>
    // OTT 선택 - 클릭 시 toggle + 저장
    const ottImages = document.querySelectorAll('.ott-options img');
    ottImages.forEach(img => {
        img.addEventListener('click', () => {
            img.classList.toggle('selected');
        });
    });

    // 장르 선택 버튼 처리
    const genreButtons = document.querySelectorAll('.genre-options button');
    genreButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault(); // 버튼 submit 막기
            btn.classList.toggle('selected');
        });
    });

    // 제출 전 hidden 값 세팅
    function handleSubmit() {
    const selectedOTTs = Array.from(document.querySelectorAll('.ott-options img.selected'))
        .map(img => img.dataset.value); // data-value 값

    const selectedGenres = Array.from(document.querySelectorAll('.genre-options button.selected'))
        .map(btn => btn.textContent.trim());

    if(selectedOTTs.length === 0){
        alert('적어도 하나 이상의 OTT를 선택해주세요!');
        return false;
    }

    document.getElementById('subscribedOTTs').value = selectedOTTs.join(',');
    document.getElementById('preferredGenres').value = selectedGenres.join(',');

    return true;
}
</script>

</body>
</html>
